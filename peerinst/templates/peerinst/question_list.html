{% extends 'peerinst/base.html' %}

{% load compress i18n %}

{% block body %}
<main>
  <section>
    <h1 class="mdc-typography--display3" style="position:sticky;"> {{assignment.title}}
      <svg class="underline" width=150 height=4></svg>
    </h1>

    {% if user.is_staff %}
    <div class="admin-link">
      <a href="{% url 'assignment-update' assignment_id=assignment.identifier%}">{% trans 'Edit question list' %}</a>
    </div>
    {% endif %}

    <h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Questions' %}</h2>

    <ol>
    {% for obj in object_list %}
      <li class="dense-list mdc-typography--body1"> {{ obj.text|safe }}

      <div class="mdc-typography--caption">
        <a href="{% url 'question' assignment_id=assignment.pk question_id=obj.pk %}">{{ obj.title|safe }}</a>:
        {% for c in obj.category.all %}
          {{ c.title|safe }}
        {% empty %}
          {% trans 'Uncategorized' %}
        {% endfor %}
      </div>

      <div id="stats-{{obj.id}}" class="stats">
        <i class="material-icons analytics-tags" onclick="showAssignments({{ obj.id }})">description</i>{{ obj.assignment_set.all.count }}
        <i class="material-icons analytics-tags" onclick="showRationales({{ obj.id }})">chat</i>{{ obj.answer_set.all.count }}
        <i class="material-icons analytics-tags" onclick="showAnalytics({{ obj.id }})">assessment</i>
        <span id="rating-{{obj.id}}"></span>
        <a href="{% url 'question' assignment_id=assignment.pk question_id=obj.pk %}"><i style="overflow:visible;transform: translateY(8px);" class="material-icons analytics-tags ripple-icon mdc-theme--primary mdc-ripple-surface--primary md-32">play_arrow</i></a>
      </div>

      {% if obj.image %}
      <img class="question-image" src="{{ obj.image.url }}"
        width=200 alt="obj.image_alt_text">
      {% endif %}
      <div style="clear:both;"></div>
      <div>
        <span id="{{ obj.id }}" name="analytics" class="items-for-question"><b>Analytics:</b></span>
        <div id="{{ obj.id }}" name="analytics" class="items-for-question">
          <svg id="first-frequency-{{ obj.id }}" width="300" height="80" style="vertical-align:middle"></svg>
          <svg id="matrix-{{ obj.id }}" width="60" height="60" style="vertical-align:middle"></svg>
          <svg id="second-frequency-{{ obj.id }}" width="300" height="80" style="vertical-align:middle"></svg>
        </div>
      </div>
      <div>
        <span id="{{ obj.id }}" name="assignment" class="items-for-question"><b>Assignments:</b></span>
        <ul>
          {% for assignment in obj.assignment_set.all %}
          <li id="{{ obj.id }}" name="assignment" class="items-for-question"><a href="{% url 'question-list' assignment_id=assignment.pk %}">{{ assignment.title }}</a></li>
          {% endfor %}
        </ul>
      </div>
      <div>
        <span id="{{ obj.id }}" name="rationale" class="items-for-question"><b>Rationales:</b></span>
        <ul>
          {% for answer in obj.answer_set.all %}
          <li id="{{ obj.id }}" name="rationale" class="items-for-question">{{ answer.rationale|safe|striptags  }}</li>
          {% endfor %}
        </ul>
      </div>
      </li>
      {% empty %}
      <li>{% trans 'No questions available.' %}</li>
      {% endfor %}
    </ol>
</section>
</main>
{% endblock %}

{% block scripts %}
{% compress js inline %}
<script>
document.querySelectorAll('.ripple-icon').forEach(
  function(x,i,a) {
    const ripple = bundle.ripple.MDCRipple.attachTo(x);
    ripple.unbounded = true;
  }
)
function showItems(items,id){
for (var i=0; i<items.length; i++){
if (items[i].id == id){
  if (items[i].style.display != "block"){
    items[i].style.display = "block";
  } else {
    items[i].style.display = "none";
  }
}
}
return;
}
function showAnalytics(id){
var items = document.getElementsByName('analytics');
showItems(items,id);
bundle.selectAll("#first_choice-"+id).transition().duration(1000).attr("x",function(d){return bundle.select(this).attr("finalx");}).attr("width",function(d){return bundle.select(this).attr("finalwidth");});
bundle.selectAll("#second_choice-"+id).transition().delay(1000).duration(1000).attr("width",function(d){return bundle.select(this).attr("finalwidth");});
return;
}
function showAssignments(id){
var items = document.getElementsByName('assignment');
showItems(items,id);
return;
}
function showRationales(id){
var items = document.getElementsByName('rationale');
showItems(items,id);
return;
}
</script>
{% for obj in object_list %}
<script>
bundle.plot({{ obj.get_matrix|safe }},{{ obj.get_frequency|safe|striptags }},{{ obj.id }});
</script>
{% endfor %}
{% endcompress %}
{% endblock %}
