{% extends 'peerinst/base.html' %}

{% load i18n %}

{% block body %}

<main>
  <section>
    <h1 class="mdc-typography--display3" style="position:sticky;"> {% trans 'Blink' %}
      <svg class="underline" width=150 height=4></svg>
    </h1>

    {% if user.teacher and assignment %}
    <h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Waiting for students' %}</h2>

    <p style="margin-bottom:10pt;">{% trans 'Student link' %}: <span class="bold">{{ request.get_host}}{% url 'blink-get-current' teacher.user.username %}</span></p>

    <a href="{% url 'blinkAssignment-start' assignment %}" style="transform:translateY(4pt);">
      <i class="mdc-theme--primary material-icons md-48">play_circle_filled</i>
    </a>
    {% else %}
    <h2 class="mdc-typography--display1 mdc-theme--secondary">{% trans 'Waiting for teacher' %}</h2>
    {% endif %}

  </section>
</main>

{% endblock %}

{% block scripts %}
{% if not request.user.is_authenticated %}
<script>
function processResponse(text, status, obj) {
  var response = jQuery(text).text();
  console.info(response);
  console.info(status);
  console.info(obj);

  if (response != 'stop') {
    if (status == 'success' & window.location.pathname != response) {
      clearInterval(status);
      location = response;
    }
  }
}

function checkURL() {
  $.get("{% url 'blink-get-current-url' username=teacher.user.username %}",processResponse);
}

var status = window.setInterval(checkURL,1000);
</script>
{% endif %}
{% endblock %}
